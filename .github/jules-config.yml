# Jules AI Configuration
# This file configures the behavior of Jules code review and self-healing
# Powered by Claude Code CLI (works with Claude Max subscription)

# ============================================================================
# AUTHENTICATION OPTIONS (choose one)
# ============================================================================
#
# Option 1: Claude Max via AWS Bedrock (Recommended for CI/CD)
#   Set these secrets in your GitHub repository:
#   - CLAUDE_CODE_USE_BEDROCK: "1"
#   - AWS_ACCESS_KEY_ID: your-key
#   - AWS_SECRET_ACCESS_KEY: your-secret
#   - AWS_REGION: us-east-1 (or your region)
#
# Option 2: Direct Anthropic API
#   Set this secret in your GitHub repository:
#   - ANTHROPIC_API_KEY: your-api-key
#
# ============================================================================

review:
  # Enable/disable review features
  enabled: true

  # Review focus areas
  focus:
    security:
      enabled: true
      severity: critical  # critical, high, medium, low
      checks:
        - sql_injection
        - xss
        - insecure_auth
        - sensitive_data_exposure
        - security_misconfiguration
        - vulnerable_dependencies

    performance:
      enabled: true
      severity: warning
      checks:
        - inefficient_loops
        - n_plus_one_queries
        - memory_leaks
        - unnecessary_computations
        - large_bundle_size

    style:
      enabled: true
      severity: info
      checks:
        - naming_conventions
        - error_handling
        - code_readability
        - documentation

  # Auto-fix behavior
  auto_fix:
    enabled: true
    # Only auto-fix these severity levels
    severities:
      - critical
    # Require approval before pushing auto-fixes
    require_approval: false

  # Comment behavior
  comments:
    # Post inline comments for warnings
    inline: true
    # Post summary comment
    summary: true
    # LGTM comment when approved
    lgtm: true

self_healing:
  # Enable/disable self-healing
  enabled: true

  # Maximum auto-fix attempts per branch (security limit)
  max_attempts: 3

  # Workflows to monitor for failures
  monitored_workflows:
    - CI
    - Build
    - Test
    - Lint

  # Auto-fix patterns (fallback when Claude Code unavailable)
  fixable_patterns:
    - name: lockfile_mismatch
      pattern: "lockfile|package-lock|npm ERR!"
      fix: "npm install"

    - name: lint_errors
      pattern: "eslint|lint error"
      fix: "npm run lint -- --fix"

    - name: formatting
      pattern: "prettier|formatting"
      fix: "npm run format"

    - name: type_errors
      pattern: "typescript|TS\\d+"
      fix: null  # Requires manual intervention

    - name: test_failures
      pattern: "test failed|assertion"
      fix: null  # Requires manual intervention

  # Escalation settings
  escalation:
    # Create issue when max attempts reached
    create_issue: true
    # Labels for escalation issues
    labels:
      - ci-failure
      - needs-attention
    # Assignees for escalation (GitHub usernames)
    assignees: []

# File patterns to include in review
include:
  - "**/*.js"
  - "**/*.ts"
  - "**/*.tsx"
  - "**/*.jsx"
  - "**/*.py"
  - "**/*.java"
  - "**/*.go"
  - "**/*.rs"
  - "**/*.rb"
  - "**/*.php"
  - "**/*.cs"
  - "**/*.cpp"
  - "**/*.c"
  - "**/*.h"

# File patterns to exclude from review
exclude:
  - "**/node_modules/**"
  - "**/dist/**"
  - "**/build/**"
  - "**/*.min.js"
  - "**/vendor/**"
  - "**/.git/**"

# Claude Code CLI settings
claude_code:
  # Use --print flag for non-interactive mode
  non_interactive: true
  # Timeout for Claude Code operations (seconds)
  timeout: 300
